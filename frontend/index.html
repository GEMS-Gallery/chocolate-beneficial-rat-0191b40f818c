<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categorized Task List - v0 Style</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.28.0/feather.min.js"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #ffffff;
            color: #111111;
            line-height: 1.5;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        h2 {
            font-weight: 600;
            font-size: 1.25rem;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            letter-spacing: -0.025em;
            display: flex;
            align-items: center;
        }
        
        .category-icon {
            margin-right: 0.75rem;
        }
        
        .task-list {
            list-style-type: none;
            padding-left: 0;
            margin-top: 0;
        }
        
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .task-item:last-child {
            border-bottom: none;
        }
        
        .task-name {
            font-size: 0.875rem;
            color: #374151;
            font-weight: 500;
        }
        
        .due-date {
            font-size: 0.75rem;
            background-color: #fef3c7;
            color: #92400e;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }
        
        .overdue {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
        }
        
        .btn {
            background-color: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
        }
        
        .btn:hover {
            background-color: #2563eb;
        }
        
        @media (max-width: 640px) {
            .task-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .due-date {
                margin-top: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [categories, setCategories] = useState([]);
            const [newCategory, setNewCategory] = useState({ name: '', icon: '' });
            const [newTask, setNewTask] = useState({ categoryId: '', title: '', dueDate: '' });

            useEffect(() => {
                fetchCategories();
            }, []);

            async function fetchCategories() {
                try {
                    const result = await window.canister.getCategories();
                    setCategories(result);
                } catch (error) {
                    console.error('Error fetching categories:', error);
                }
            }

            async function handleAddCategory(e) {
                e.preventDefault();
                try {
                    await window.canister.addCategory(newCategory.name, newCategory.icon);
                    setNewCategory({ name: '', icon: '' });
                    fetchCategories();
                } catch (error) {
                    console.error('Error adding category:', error);
                }
            }

            async function handleAddTask(e) {
                e.preventDefault();
                try {
                    const dueDate = new Date(newTask.dueDate).getTime() * 1000000; // Convert to nanoseconds
                    await window.canister.addTask(Number(newTask.categoryId), newTask.title, dueDate);
                    setNewTask({ categoryId: '', title: '', dueDate: '' });
                    fetchCategories();
                } catch (error) {
                    console.error('Error adding task:', error);
                }
            }

            async function handleEditTaskDate(categoryId, taskId, newDate) {
                try {
                    const newDueDate = new Date(newDate).getTime() * 1000000; // Convert to nanoseconds
                    await window.canister.editTaskDate(categoryId, taskId, newDueDate);
                    fetchCategories();
                } catch (error) {
                    console.error('Error editing task date:', error);
                }
            }

            return (
                <div>
                    <h1>Task Manager</h1>
                    
                    <h2>Add New Category</h2>
                    <form onSubmit={handleAddCategory}>
                        <div className="form-group">
                            <label>Name:</label>
                            <input 
                                type="text" 
                                value={newCategory.name} 
                                onChange={(e) => setNewCategory({...newCategory, name: e.target.value})}
                                required
                            />
                        </div>
                        <div className="form-group">
                            <label>Icon:</label>
                            <input 
                                type="text" 
                                value={newCategory.icon} 
                                onChange={(e) => setNewCategory({...newCategory, icon: e.target.value})}
                                required
                            />
                        </div>
                        <button type="submit" className="btn">Add Category</button>
                    </form>

                    <h2>Add New Task</h2>
                    <form onSubmit={handleAddTask}>
                        <div className="form-group">
                            <label>Category:</label>
                            <select 
                                value={newTask.categoryId} 
                                onChange={(e) => setNewTask({...newTask, categoryId: e.target.value})}
                                required
                            >
                                <option value="">Select a category</option>
                                {categories.map((category) => (
                                    <option key={category.id} value={category.id}>{category.name}</option>
                                ))}
                            </select>
                        </div>
                        <div className="form-group">
                            <label>Title:</label>
                            <input 
                                type="text" 
                                value={newTask.title} 
                                onChange={(e) => setNewTask({...newTask, title: e.target.value})}
                                required
                            />
                        </div>
                        <div className="form-group">
                            <label>Due Date:</label>
                            <input 
                                type="date" 
                                value={newTask.dueDate} 
                                onChange={(e) => setNewTask({...newTask, dueDate: e.target.value})}
                                required
                            />
                        </div>
                        <button type="submit" className="btn">Add Task</button>
                    </form>

                    {categories.map((category) => (
                        <div key={category.id}>
                            <h2>
                                <i data-feather={category.icon} className="category-icon"></i>
                                {category.name}
                            </h2>
                            <ul className="task-list">
                                {category.tasks.map((task) => (
                                    <li key={task.id} className="task-item">
                                        <span className="task-name">{task.title}</span>
                                        <input 
                                            type="date" 
                                            value={new Date(Number(task.dueDate) / 1000000).toISOString().split('T')[0]} 
                                            onChange={(e) => handleEditTaskDate(category.id, task.id, e.target.value)}
                                            className={`due-date ${task.isOverdue ? 'overdue' : ''}`}
                                        />
                                    </li>
                                ))}
                            </ul>
                        </div>
                    ))}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

    <script>
        feather.replace();
    </script>
</body>
</html>
